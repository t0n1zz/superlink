generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserType {
  BUILDER
  STUDENT
  COMPANY
  UNIVERSITY
}

enum SkillLevel {
  BEGINNER
  INTERMEDIATE
  EXPERT
}

enum FairScoreTier {
  BRONZE    // 0-299
  SILVER    // 300-599
  GOLD      // 600-899
  PLATINUM  // 900+
}

model User {
  id                String         @id @default(cuid())
  walletAddress     String         @unique
  email             String?        @unique
  userType          UserType       @default(BUILDER)

  // Profile Info
  name              String?
  bio               String?
  profilePhoto      String?
  city              String?
  province          String?
  country           String         @default("Indonesia")
  latitude          Float?
  longitude         Float?

  // Contact & Social
  twitter           String?
  github            String?
  linkedin          String?
  telegram          String?
  discord           String?
  website           String?

  // Professional Info
  hourlyRate        Int?
  currency          String         @default("USDC")
  availability      String         @default("available") // available, busy, not_looking
  languages         String[]       @default(["Indonesian", "English"])

  // FairScore Integration
  fairScore         Int            @default(0)
  fairScoreTier     FairScoreTier  @default(BRONZE)
  lastFairScoreSync DateTime?
  fairScoreHistory  Json?          // Store historical scores

  // Student-specific
  university        String?
  major             String?
  graduationYear    Int?
  studentId         String?
  isStudentVerified Boolean        @default(false)

  // Platform Stats
  projectsCompleted Int            @default(0)
  totalEarnings     Float          @default(0)
  responseTime      Int?           // Average in hours
  rating            Float          @default(0)

  // Timestamps
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  lastActive        DateTime       @default(now())

  // Relations
  skills            UserSkill[]
  endorsements      Endorsement[]  @relation("EndorsementReceiver")
  givenEndorsements Endorsement[]  @relation("EndorsementGiver")
  portfolioItems    Portfolio[]
  jobApplications   JobApplication[]
  postedJobs        Job[]
  reviews           Review[]       @relation("ReviewReceiver")
  givenReviews      Review[]       @relation("ReviewGiver")

  @@index([walletAddress])
  @@index([city, province])
  @@index([fairScore])
}

model Skill {
  id          String      @id @default(cuid())
  name        String      @unique
  category    String      // Development, Design, Marketing, etc.
  icon        String?
  users       UserSkill[]
  createdAt   DateTime    @default(now())
}

model UserSkill {
  id           String     @id @default(cuid())
  userId       String
  skillId      String
  level        SkillLevel @default(BEGINNER)
  yearsExp     Int?
  endorseCount Int        @default(0)

  user         User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  skill        Skill      @relation(fields: [skillId], references: [id])

  @@unique([userId, skillId])
  @@index([userId])
}

model Endorsement {
  id          String   @id @default(cuid())
  giverId     String
  receiverId  String
  skillId     String?
  message     String?
  createdAt   DateTime @default(now())

  giver       User     @relation("EndorsementGiver", fields: [giverId], references: [id])
  receiver    User     @relation("EndorsementReceiver", fields: [receiverId], references: [id])

  @@index([receiverId])
}

model Portfolio {
  id          String   @id @default(cuid())
  userId      String
  title       String
  description String?
  imageUrl    String?
  projectUrl  String?
  tags        String[]
  createdAt   DateTime @default(now())

  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Job {
  id              String           @id @default(cuid())
  posterId        String
  title           String
  description     String
  category        String
  budget          Int?
  budgetCurrency  String           @default("USDC")
  budgetType      String           // fixed, hourly
  timeline        String?
  location        String?
  isRemote        Boolean          @default(true)

  // FairScore requirements
  minFairScore    Int              @default(0)
  requiredSkills String[]

  status          String           @default("open") // open, in_progress, completed, closed

  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt

  poster          User             @relation(fields: [posterId], references: [id])
  applications    JobApplication[]

  @@index([posterId])
  @@index([status])
  @@index([minFairScore])
}

model JobApplication {
  id           String   @id @default(cuid())
  jobId        String
  applicantId  String
  coverLetter  String?
  proposedRate Int?
  status       String   @default("pending") // pending, accepted, rejected
  createdAt    DateTime @default(now())

  job          Job      @relation(fields: [jobId], references: [id], onDelete: Cascade)
  applicant    User     @relation(fields: [applicantId], references: [id])

  @@unique([jobId, applicantId])
  @@index([applicantId])
}

model Review {
  id          String   @id @default(cuid())
  giverId     String
  receiverId  String
  jobId       String?
  rating      Int      // 1-5
  comment     String?
  createdAt   DateTime @default(now())

  giver       User     @relation("ReviewGiver", fields: [giverId], references: [id])
  receiver    User     @relation("ReviewReceiver", fields: [receiverId], references: [id])

  @@index([receiverId])
}

model University {
  id           String   @id @default(cuid())
  name         String   @unique
  city         String
  province     String
  website      String?
  verified     Boolean  @default(false)
  studentCount Int      @default(0)
  createdAt    DateTime @default(now())
}

model SuperearnImport {
  id                 String   @id @default(cuid())
  userId             String   @unique
  username           String
  totalBounties      Int
  completedBounties  Int
  totalEarned        Float
  lastImport         DateTime @default(now())
  data               Json     // Store full bounty history
}
